[{"path":"https://hohoweiya.xyz/earth.dof.patch/articles/ozone.html","id":"ozone-data","dir":"Articles","previous_headings":"","what":"Ozone Data","title":"Application to Ozone Data","text":"Ozone data shift earth package, called ozone1 check performance higher dimension, can manually create 50 nuisance features. calculate corrected penalty given fitted earth object mod, refit earth model new penalty perform 5-fold cross-validation use linear terms, allow second-degree interactions,","code":"set.seed(1234) ozone1 = cbind(ozone1, matrix(rnorm(nrow(ozone1) * 50), ncol = 50)) head(ozone1) #>   O3   vh wind humidity temp  ibh dpg ibt vis doy #> 1  3 5710    4       28   40 2693 -25  87 250  33 #> 2  5 5700    3       37   45  590 -24 128 100  34 #> 3  5 5760    3       51   54 1450  25 139  60  35 #> 4  6 5720    4       69   35 1568  15 121  60  36 #> 5  4 5790    6       19   45 2631 -33 123 100  37 #> 6  4 5790    3       25   55  554 -28 182 250  38 mod = earth(O3 ~ ., data = ozone1) summary(mod) #> Call: earth(formula=O3~., data=ozone1) #>  #>                coefficients #> (Intercept)      14.1595171 #> h(5860-vh)       -0.0137728 #> h(wind-3)        -0.3377222 #> h(54-humidity)   -0.1349547 #> h(temp-58)        0.2791320 #> h(1105-ibh)      -0.0033837 #> h(dpg-10)        -0.0991581 #> h(ibt-120)        0.0326330 #> h(150-vis)        0.0231881 #> h(96-doy)        -0.1105145 #> h(doy-96)         0.0406468 #> h(doy-158)       -0.0836732 #>  #> Selected 12 of 20 terms, and 9 of 9 predictors #> Termination condition: Reached nk 21 #> Importance: temp, humidity, dpg, doy, vh, ibh, vis, ibt, wind #> Number of terms at each degree of interaction: 1 11 (additive model) #> GCV 14.61004    RSS 4172.671    GRSq 0.7730502    RSq 0.8023874 res = correct_df(mod) mod1 = earth(O3 ~ ., data = ozone1, penalty = res$penalty) summary(mod1) #> Call: earth(formula=O3~., data=ozone1, penalty=res$penalty) #>  #>                coefficients #> (Intercept)      15.5159893 #> h(5860-vh)       -0.0157353 #> h(wind-3)        -0.3192190 #> h(54-humidity)   -0.1404223 #> h(temp-58)        0.3044700 #> h(1105-ibh)      -0.0035028 #> h(dpg-10)        -0.0891300 #> h(ibt-120)        0.0321264 #> h(150-vis)        0.0223795 #> h(96-doy)        -0.1350538 #> h(doy-158)       -0.0358712 #>  #> Selected 11 of 20 terms, and 9 of 9 predictors #> Termination condition: Reached nk 21 #> Importance: temp, humidity, dpg, doy, vh, ibh, vis, ibt, wind #> Number of terms at each degree of interaction: 1 10 (additive model) #> GCV 15.12914    RSS 4234.168    GRSq 0.7649866    RSq 0.7994749 cv_compare = function(nfold = 5, degree = 2) {   n = nrow(ozone1)   folds = rep(1:nfold, each = n / nfold)   folds = folds[sample(1:n, n)] # re-order   errs = matrix(0, nrow = 2, ncol = nfold)   corrected_penalty = NULL   for (k in 1:nfold) {     train = ozone1[folds != k, ]     test = ozone1[folds == k, ]     mod = earth(O3 ~ ., data = train, degree = degree)     if (is.null(corrected_penalty)) {       dfs = correct_df(mod)       corrected_penalty = dfs$penalty       cat(\"corrected penalty = \", dfs$penalty, \"\\n\")     }     mod1 = earth(O3 ~ ., data = train, degree = degree, penalty = corrected_penalty)     pred = predict(mod, newdata = test)     pred1 = predict(mod1, newdata = test)     errs[, k] = c(mean((test$O3 - pred)^2), mean((test$O3 - pred1)^2))   }   mu = rowMeans(errs)   se = apply(errs, 1, sd) / sqrt(nfold)   cat(\"CV error = \\n\")   print(mu)   cat(\"CV error se = \\n\")   print(se)   return(errs) } set.seed(1234) errs.d1 = cv_compare(5, 1) #> corrected penalty =  2.99357  #> CV error =  #> [1] 16.65751 16.61001 #> CV error se =  #> [1] 2.294709 2.266587 set.seed(1234) errs.d2 = cv_compare(5, 2) #> corrected penalty =  3.92098  #> CV error =  #> [1] 17.32851 17.20663 #> CV error se =  #> [1] 2.336629 2.423364"},{"path":"https://hohoweiya.xyz/earth.dof.patch/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Lijun Wang. Maintainer.","code":""},{"path":"https://hohoweiya.xyz/earth.dof.patch/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Wang L (2025). earth.dof.patch: Correct DoF earth Package. R package version 0.3.0, https://github.com/szcf-weiya/earth.dof.patch.","code":"@Manual{,   title = {earth.dof.patch: Correct DoF in earth Package},   author = {Lijun Wang},   year = {2025},   note = {R package version 0.3.0},   url = {https://github.com/szcf-weiya/earth.dof.patch}, }"},{"path":"https://hohoweiya.xyz/earth.dof.patch/index.html","id":"earthdofpatch","dir":"","previous_headings":"","what":"Correct DoF in earth Package","title":"Correct DoF in earth Package","text":"earth.dof.patch R package providing patch (correction) degrees freedom (dof) MARS (Multivariate Adaptive Regression Splines), whose R package called earth. correction shown achieve better performance, see details paper. Wang, L., Zhao, H., & Fan, X. (2024). Degrees Freedom: Search Cost Self-consistency. Journal Computational Graphical Statistics, 0(ja), 1â€“23. https://doi.org/10.1080/10618600.2024.2388545","code":""},{"path":"https://hohoweiya.xyz/earth.dof.patch/index.html","id":"rocket-only-one-line-to-correct","dir":"","previous_headings":"","what":"ðŸš€ Only One Line to Correct","title":"Correct DoF in earth Package","text":"Suppose fit MARS model via earth, correct degrees freedom, just one line: refit MARS model specifying corrected degrees freedom, examples can found auto-generated vignettes https://hohoweiya.xyz/earth.dof.patch/, including simulations comparing MSE prediction task Ozone data classification task Spam email data examples, corrected MARS outperforms corresponding MARS. See also: Julia package DegreesOfFreedom.jl also provide implementation DoF MARS, together implementations classical statistical learning approaches.","code":"model = earth(y ~ ., data = data) df = correct_df(model) model.corrected = earth(y ~ ., data = data, penalty = df$penalty)"},{"path":"https://hohoweiya.xyz/earth.dof.patch/reference/calc_df_mars.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate degrees of freedom of MARS â€” calc_df_mars","title":"Calculate degrees of freedom of MARS â€” calc_df_mars","text":"Calculate degrees freedom MARS","code":""},{"path":"https://hohoweiya.xyz/earth.dof.patch/reference/calc_df_mars.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate degrees of freedom of MARS â€” calc_df_mars","text":"","code":"calc_df_mars(n = 100, p = 10, N = 100, nk = 5, d = 1, penalty = 2, seed = 1234)"},{"path":"https://hohoweiya.xyz/earth.dof.patch/reference/calc_df_mars.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate degrees of freedom of MARS â€” calc_df_mars","text":"n sample size p number features N number repetitions nk maximum number model terms pruning earth::earth d maximum degree interactions penalty penalty per knot seed random seed construct x y","code":""},{"path":"https://hohoweiya.xyz/earth.dof.patch/reference/calc_df_mars.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate degrees of freedom of MARS â€” calc_df_mars","text":"vector two elements: dfcov empirical df based covariance formula dfapp average df based mars' approximation formula","code":""},{"path":"https://hohoweiya.xyz/earth.dof.patch/reference/correct_df.html","id":null,"dir":"Reference","previous_headings":"","what":"Correct df given a fitted earth.object â€” correct_df","title":"Correct df given a fitted earth.object â€” correct_df","text":"Correct df given fitted earth.object","code":""},{"path":"https://hohoweiya.xyz/earth.dof.patch/reference/correct_df.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Correct df given a fitted earth.object â€” correct_df","text":"","code":"correct_df(x, N = 100)"},{"path":"https://hohoweiya.xyz/earth.dof.patch/reference/correct_df.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Correct df given a fitted earth.object â€” correct_df","text":"x earth object N number repetitions approximating empirical df","code":""},{"path":"https://hohoweiya.xyz/earth.dof.patch/reference/correct_df.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Correct df given a fitted earth.object â€” correct_df","text":"list three elements df_cov empirical df based covariance formula df_app average df based mars' approximation formula penalty penalty factor","code":""},{"path":"https://hohoweiya.xyz/earth.dof.patch/reference/flag.esl.trainset.html","id":null,"dir":"Reference","previous_headings":"","what":"Datasets The indicator for training and test sets for the Spam email data. See also: https://hastie.su.domains/ElemStatLearn/ â€” flag.esl.trainset","title":"Datasets The indicator for training and test sets for the Spam email data. See also: https://hastie.su.domains/ElemStatLearn/ â€” flag.esl.trainset","text":"Datasets indicator training test sets Spam email data. See also: https://hastie.su.domains/ElemStatLearn/","code":""},{"path":"https://hohoweiya.xyz/earth.dof.patch/reference/flag.esl.trainset.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Datasets The indicator for training and test sets for the Spam email data. See also: https://hastie.su.domains/ElemStatLearn/ â€” flag.esl.trainset","text":"","code":"flag.esl.trainset"},{"path":"https://hohoweiya.xyz/earth.dof.patch/reference/flag.esl.trainset.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Datasets The indicator for training and test sets for the Spam email data. See also: https://hastie.su.domains/ElemStatLearn/ â€” flag.esl.trainset","text":"## `flag.esl.trainset`","code":""},{"path":"https://hohoweiya.xyz/earth.dof.patch/reference/sol_mars_df_and_penalty.html","id":null,"dir":"Reference","previous_headings":"","what":"Solve penalty factor by equating empirical df â€” sol_mars_df_and_penalty","title":"Solve penalty factor by equating empirical df â€” sol_mars_df_and_penalty","text":"Solve penalty factor equating empirical df","code":""},{"path":"https://hohoweiya.xyz/earth.dof.patch/reference/sol_mars_df_and_penalty.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Solve penalty factor by equating empirical df â€” sol_mars_df_and_penalty","text":"","code":"sol_mars_df_and_penalty(n = 20, p = 2, N = 100, nk = 5, d = 1, penalty = NULL)"},{"path":"https://hohoweiya.xyz/earth.dof.patch/reference/sol_mars_df_and_penalty.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Solve penalty factor by equating empirical df â€” sol_mars_df_and_penalty","text":"n sample size p number features N number repetitions nk maximum number model terms pruning earth::earth d maximum degree interactions penalty initial penalty. specified, `d + 1`.","code":""},{"path":"https://hohoweiya.xyz/earth.dof.patch/reference/sol_mars_df_and_penalty.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Solve penalty factor by equating empirical df â€” sol_mars_df_and_penalty","text":"list three elements df_cov empirical df based covariance formula df_app average df based mars' approximation formula penalty penalty factor","code":""},{"path":"https://hohoweiya.xyz/earth.dof.patch/reference/sol_mars_df_and_penalty.html","id":"note","dir":"Reference","previous_headings":"","what":"Note","title":"Solve penalty factor by equating empirical df â€” sol_mars_df_and_penalty","text":"Note `penalty` works backward procedure, need loop ensure self-consistency.","code":""},{"path":"https://hohoweiya.xyz/earth.dof.patch/reference/spam.html","id":null,"dir":"Reference","previous_headings":"","what":"Datasets Spam email data. Also accessible from https://archive.ics.uci.edu/dataset/94/spambase, https://hastie.su.domains/ElemStatLearn/, or https://github.com/szcf-weiya/ESL-CN/tree/master/data/Spam. â€” spam","title":"Datasets Spam email data. Also accessible from https://archive.ics.uci.edu/dataset/94/spambase, https://hastie.su.domains/ElemStatLearn/, or https://github.com/szcf-weiya/ESL-CN/tree/master/data/Spam. â€” spam","text":"Datasets Spam email data. Also accessible https://archive.ics.uci.edu/dataset/94/spambase, https://hastie.su.domains/ElemStatLearn/, https://github.com/szcf-weiya/ESL-CN/tree/master/data/Spam.","code":""},{"path":"https://hohoweiya.xyz/earth.dof.patch/reference/spam.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Datasets Spam email data. Also accessible from https://archive.ics.uci.edu/dataset/94/spambase, https://hastie.su.domains/ElemStatLearn/, or https://github.com/szcf-weiya/ESL-CN/tree/master/data/Spam. â€” spam","text":"","code":"spam"},{"path":"https://hohoweiya.xyz/earth.dof.patch/reference/spam.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Datasets Spam email data. Also accessible from https://archive.ics.uci.edu/dataset/94/spambase, https://hastie.su.domains/ElemStatLearn/, or https://github.com/szcf-weiya/ESL-CN/tree/master/data/Spam. â€” spam","text":"## `spam`","code":""}]
